<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shopping Cart - Electronics Store</title>
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>
  <!-- Header -->
  <header>
    <nav class="container">
      <a href="index.html" class="logo">âš¡ ElectroShop</a>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="products.html">Products</a></li>
        <li><a href="#" id="ordersLink" style="display: none;">My Orders</a></li>
        <li><a href="#" id="adminLink" style="display: none;">Admin</a></li>
      </ul>
      <div class="nav-right">
        <div class="user-info" id="userInfo" style="display: none;">
          <span class="user-name" id="userName"></span>
          <a href="#" class="btn btn-small btn-secondary" id="logoutBtn">Logout</a>
        </div>
        <div id="authLinks">
          <a href="login.html" class="btn btn-small btn-outline">Login</a>
          <a href="signup.html" class="btn btn-small btn-primary">Sign Up</a>
        </div>
        <a href="cart.html" class="cart-icon">
          ðŸ›’
          <span class="cart-count" id="cartCount">0</span>
        </a>
      </div>
    </nav>
  </header>

  <!-- Main Content -->
  <main class="cart-page">
    <div class="container">
      <h2>Shopping Cart</h2>

      <div id="emptyCart" class="empty-cart" style="display: none;">
        <div class="empty-cart-icon">ðŸ›’</div>
        <h3>Your cart is empty</h3>
        <p>Add some products to get started!</p>
        <a href="products.html" class="btn btn-primary">Shop Now</a>
      </div>

      <div id="cartContent" class="cart-container">
        <div class="cart-items" id="cartItems">
          <!-- Cart items will be loaded here -->
        </div>

        <div class="cart-summary">
          <h3>Order Summary</h3>
          <div class="summary-row">
            <span>Subtotal:</span>
            <span id="subtotal">$0.00</span>
          </div>
          <div class="summary-row">
            <span>Shipping:</span>
            <span>Free</span>
          </div>
          <div class="summary-row summary-total">
            <span>Total:</span>
            <span id="total">$0.00</span>
          </div>
          <button class="btn btn-primary" style="width: 100%; margin-top: 1rem;" onclick="proceedToCheckout()">
            Proceed to Checkout
          </button>
          <a href="products.html" class="btn btn-outline" style="width: 100%; margin-top: 0.5rem; text-align: center;">
            Continue Shopping
          </a>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="footer-content">
        <p>&copy; 2024 ElectroShop. All rights reserved.</p>
        <ul class="footer-links">
          <li><a href="#">About</a></li>
          <li><a href="#">Contact</a></li>
          <li><a href="#">Privacy Policy</a></li>
        </ul>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/supabase-config.js"></script>
  <script src="js/api.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/cart.js"></script>
  <script>
    let cartItems = [];

    // Load cart on page load
    document.addEventListener('DOMContentLoaded', () => {
      updateAuthUI();
      updateCartCount();
      loadCart();
    });

    // Load cart items
    async function loadCart() {
      try {
        cartItems = await Cart.getItems();
        displayCart();
      } catch (error) {
        console.error('Error loading cart:', error);
      }
    }

    // Display cart items
    function displayCart() {
      const emptyCart = document.getElementById('emptyCart');
      const cartContent = document.getElementById('cartContent');
      const cartItemsEl = document.getElementById('cartItems');

      if (cartItems.length === 0) {
        emptyCart.style.display = 'block';
        cartContent.style.display = 'none';
        return;
      }

      emptyCart.style.display = 'none';
      cartContent.style.display = 'grid';

      cartItemsEl.innerHTML = cartItems.map(item => `
        <div class="cart-item" data-product-id="${item.id}">
          <img src="${item.image}" alt="${item.name}" class="cart-item-image">
          <div class="cart-item-info">
            <h3>${item.name}</h3>
            <div class="cart-item-price">$${item.price.toFixed(2)}</div>
            <div class="cart-item-quantity">
              <button onclick="updateQuantity(${item.id}, ${item.quantity - 1})" class="btn btn-small">-</button>
              <input type="number" value="${item.quantity}" min="1" max="${item.stock}" 
                     onchange="updateQuantity(${item.id}, this.value)" style="width: 60px; text-align: center;">
              <button onclick="updateQuantity(${item.id}, ${item.quantity + 1})" class="btn btn-small">+</button>
            </div>
          </div>
          <div class="cart-item-actions">
            <div class="cart-item-total">$${item.total.toFixed(2)}</div>
            <button class="btn btn-danger btn-small" onclick="removeItem(${item.id})">Remove</button>
          </div>
        </div>
      `).join('');

      updateSummary();
    }

    // Update cart summary
    function updateSummary() {
      const subtotal = cartItems.reduce((sum, item) => sum + item.total, 0);
      document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
      document.getElementById('total').textContent = `$${subtotal.toFixed(2)}`;
    }

    // Update item quantity
    async function updateQuantity(productId, newQuantity) {
      newQuantity = parseInt(newQuantity);

      if (newQuantity < 1) {
        removeItem(productId);
        return;
      }

      try {
        await Cart.updateQuantity(productId, newQuantity);
        cartItems = await Cart.getItems();
        displayCart();
        updateCartCount();
      } catch (error) {
        console.error('Error updating quantity:', error);
        alert('Failed to update quantity');
      }
    }

    // Remove item from cart
    async function removeItem(productId) {
      if (!confirm('Remove this item from cart?')) return;

      try {
        await Cart.removeItem(productId);
        cartItems = await Cart.getItems();
        displayCart();
        updateCartCount();
      } catch (error) {
        console.error('Error removing item:', error);
        alert('Failed to remove item');
      }
    }

    // Proceed to checkout
    function proceedToCheckout() {
      if (cartItems.length === 0) {
        alert('Your cart is empty!');
        return;
      }
      window.location.href = 'checkout.html';
    }
  </script>
</body>

</html>